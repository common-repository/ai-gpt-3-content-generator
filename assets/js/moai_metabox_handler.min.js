jQuery(document).ready((function(){moai_detect_editor()}));var editor="gutenberg",title="",content="";function moai_detect_editor(){void 0!==document.getElementById("title")&&null!==document.getElementById("title")&&(editor="classic")}function moai_get_post_title(){switch(editor){case"gutenberg":return wp.data.select("core/editor").getEditedPostAttribute("title");case"classic":default:return document.getElementById("title").value}}function moai_set_post_title(val){return new Promise((resolve,reject)=>{switch(editor){case"gutenberg":wp.data.dispatch("core/editor").editPost({title:val});break;case"classic":jQuery("#title-prompt-text").hide(),document.getElementById("title").value=val;break;default:document.getElementById("title").value=val}resolve()})}function moai_get_post_content(){switch(editor){case"gutenberg":return wp.data.select("core/editor").getEditedPostAttribute("content");case"classic":default:return document.getElementById("content").value}}function moai_remove_first_header_tag_from_content(val){if(val.startsWith(".")&&(val=val.substring(2)),val.startsWith("<h1>")){let result=val.indexOf("</h1>");val=val.substring(result+5)}else if(val.startsWith("<h2>")){let result=val.indexOf("</h2>");val=val.substring(result+5)}return val}function moai_set_post_content(val,insert_mode){return new Promise((resolve,reject)=>{if(val=moai_remove_first_header_tag_from_content(val),"copy"!==insert_mode){switch(editor){case"gutenberg":const newBlock=wp.blocks.createBlock("core/paragraph",{content:val});switch(insert_mode){case"append":wp.data.dispatch("core/block-editor").insertBlocks(newBlock);break;case"prepend":wp.data.dispatch("core/block-editor").insertBlocks(newBlock,0);break;case"replace":wp.data.dispatch("core/block-editor").resetBlocks([]),wp.data.dispatch("core/block-editor").insertBlocks(newBlock)}break;default:switch(jQuery("#content-html").click(),insert_mode){case"append":document.getElementById("content").value+=val;break;case"prepend":document.getElementById("content").value=val+document.getElementById("content").value;break;case"replace":document.getElementById("content").value=val}}resolve()}else navigator.clipboard.writeText(val)})}function moai_set_post_excerpt(val){return new Promise((resolve,reject)=>{switch(editor){case"gutenberg":wp.data.dispatch("core/editor").editPost({excerpt:val});break;case"classic":document.getElementById("excerpt").value=val;break;default:document.getElementById("excerpt").value=val}resolve()})}function moai_set_modal_title(title="AI content generator"){document.getElementById("moai-modal-title").innerText=title}function moai_set_media_image_for_post(imageUrl){return new Promise((resolve,reject)=>{var image_title=moai_get_post_title();jQuery(".moai-modal-preloader").css("display","flex");let formdata=new FormData;formdata.append("action-type","save_image"),formdata.append("action","moai_ajax_action"),formdata.append("query","save_image"),formdata.append("image_url",imageUrl),formdata.append("image_title",image_title),formdata.append("_wpnonce",ajax_object_moai.moai_ajax_nonce),ajax_request=jQuery.ajax({url:ajax_object_moai.ajax_url_moai,type:"POST",data:formdata,processData:!1,contentType:!1}),ajax_request.done(response=>{if(response.data.attachment_id)switch(editor){case"gutenberg":wp.data.select("core/editor").getEditedPostAttribute("featured_media"),wp.data.dispatch("core/editor").editPost({featured_media:response.data.attachment_id})}jQuery(".moai-modal-preloader").css("display","none"),resolve(response)}),ajax_request.fail(response=>{jQuery(".moai-modal-preloader").css("display","none"),alert(response),reject(null)})})}async function moai_selected_option(index,type,insert_mode="append"){index=index.trim();let option_content=document.getElementById("moai_option_"+index).innerHTML;switch(option_content=option_content.replace(/(^[ \t]*\n)/gm,""),type){case"title":case"set_title_continue_to_content":await moai_set_post_title(option_content.trim());break;case"content":await moai_set_post_content(option_content.trim(),insert_mode);break;case"excerpt":await moai_set_post_excerpt(option_content.trim());break;case"featured_image":option_content=document.getElementById("moai_option_"+index).innerText,await moai_set_media_image_for_post(option_content)}moai_hide_modal(),"set_title_continue_to_content"===type&&moai_generate_content()}function moai_display_option(option_content,index,type="title"){if("featured_image"===type)moai_display_featured_image_options(option_content,index,type);else{var display_content=option_content,read_more_btn="";option_content.length>370&&(display_content=option_content.substring(0,370)+"......   ",read_more_btn='<a href="#" class="moai-read-more" onclick="moai_read_more(\''+index+"');event.stopPropagation();\">Read More</a>"),"title"===type?moai_display_title_options(option_content,index,type,display_content,read_more_btn):"content"===type?moai_display_content_options(option_content,index,type,display_content,read_more_btn):moai_display_excerpt_options(option_content,index,type,display_content,read_more_btn)}}function moai_display_featured_image_options(option_content,index,type){document.getElementById("moai-modal-suggestions").innerHTML+='<div class="moai-suggestion" onclick="moai_selected_option(\''+index+"','"+type+'\');event.stopPropagation();"> \n            <div id="moai_option_'+index+'" style="display:none" >'+option_content+'</div>\n            <img src="'+option_content+"\" width='230px'/> \n        </div></br>"}function moai_display_title_options(option_content,index,type,display_content,read_more_btn){option_content.replace(/['"]+/g,""),document.getElementById("moai-modal-suggestions").innerHTML+='<div id="moai_option_'+index+'" style="display:none">'+option_content+'</div>\n    <div class="moai-suggestion" id="moai_display_option_'+index+'">'+display_content+" "+read_more_btn+'\n    <br><br>\n    <div class="moai-content-insert-options" dir="rtl">\n    <button type="button" class="button-secondary" onclick="moai_selected_option(\''+index+'\',\'set_title_continue_to_content\');">Set title and Continue to Content Generation</button>\n    <button type="button" class="button-secondary" onclick="moai_selected_option(\''+index+"','"+type+"');\">Set Title</button>\n        </div>\n    </div></br>"}function moai_display_content_options(option_content,index,type,display_content,read_more_btn){var content,button_name="Append Content";moai_get_post_content()||(button_name="Set Content");var content_insert_options=' \n    <div class="moai-content-insert-options" dir="rtl">\n        <button type="button" class="button-secondary" onclick="moai_selected_option(\''+index+"','"+type+'\', \'copy\');">Copy to clipboard</button>\n        <button type="button" class="button-secondary" onclick="moai_selected_option(\''+index+"','"+type+'\', \'replace\');">Replace Content</button>\n        <button type="button" class="button-secondary" onclick="moai_selected_option(\''+index+"','"+type+'\', \'prepend\');">Prepend Content</button>\n        <button type="button" class="button-secondary" onclick="moai_selected_option(\''+index+"','"+type+"', 'append');\">"+button_name+"</button>\n    </div>";document.getElementById("moai-modal-suggestions").innerHTML+='<div id="moai_option_'+index+'" style="display:none">'+option_content+'\n    </div>\n    <div class="moai-suggestion">\n        <div id="moai_display_option_'+index+'">'+display_content+read_more_btn+"</div>"+content_insert_options+" \n    </div>\n    </br>"}function moai_display_excerpt_options(option_content,index,type,display_content,read_more_btn){document.getElementById("moai-modal-suggestions").innerHTML+='<div id="moai_option_'+index+'" style="display:none">'+option_content+'</div>\n    <div class="moai-suggestion" id="moai_display_option_'+index+'" onclick="moai_selected_option(\''+index+"','"+type+"');\">"+display_content+" "+read_more_btn+"</div></br>"}function moai_read_more(index){document.getElementById("moai_display_option_"+index).innerHTML=document.getElementById("moai_option_"+index).innerHTML}async function moai_generate_title(title=""){if(document.getElementById("moai-modal-suggestions").innerHTML="",!title&&!(title=moai_get_post_title()))return moai_set_modal_title("What do you want to write about?"),void moai_show_title_input();moai_set_modal_title("Generating titles for: "+title);var query="Suggest title for post on "+title,results=await moai_send_metabox_query(query);results.data?results.data.forEach(result=>moai_display_option(result.text,result.index,"title")):alert("Something went wrong retry.")}function moai_show_title_input(){moai_show_modal(),document.getElementById("moai-modal-results").style.display="none",document.getElementById("moai-modal-title-input").style.display="block"}function moai_user_inputs_title(){document.getElementById("moai-modal-title-input").style.display="none",document.getElementById("moai-modal-results").style.display="block",moai_generate_title(document.getElementById("new_title").value)}async function moai_generate_content(){if(document.getElementById("moai-modal-suggestions").innerHTML="",title=moai_get_post_title()){moai_set_modal_title("Generating content for: "+title);var query="We are writing an extensive blog on WordPress the topic for the blog is: "+title+". Make sure the blog has an introduction and a conclusion too. Make sure it is html formatted.",results=await moai_send_metabox_query(query);results.data?results.data.forEach(result=>moai_display_option(result.text,result.index,"content")):alert("Something went wrong retry.")}else alert("Please enter some title to begin with.")}async function moai_generate_featured_image(){if(document.getElementById("moai-modal-suggestions").innerHTML="",title=moai_get_post_title())if(moai_set_modal_title("Generating Featured Image for: "+title),title){var query="Generate a featured images for a blog on: "+title,results=await moai_send_metabox_query(query,"image"),empty_count=0,index=0;results.data?(jQuery("#moai-modal-suggestions").css("text-align","center"),results.data.forEach(result=>{result.url?(moai_display_option(result.url,index,"featured_image"),index++):empty_count++}),3===empty_count&&(alert("Coudnt generate any image please retry."),moai_hide_modal())):alert("Something went wrong retry.")}else alert("Please enter some title to beign with.");else alert("We need a title to generate Featured Image!")}async function moai_generate_excerpt(){if(title=moai_get_post_title())if(content=moai_get_post_content()){document.getElementById("moai-modal-suggestions").innerHTML="",moai_set_modal_title("Generating Excerpt for: "+title);var query=content+"Tl;dr:",results=await moai_send_metabox_query(query),empty_count=0;results.data?(results.data.forEach(result=>{result.text.trim()?moai_display_option(result.text,result.index,"excerpt"):empty_count++}),3===empty_count&&(alert("Content too short to generate excerpt on."),moai_hide_modal())):alert("Something went wrong retry.")}else alert("We need some content to generate Excerpt for!");else alert("Your post does not have a title yet!")}function moai_send_metabox_query(query,type="text"){return new Promise((resolve,reject)=>{moai_show_modal();var preloder=document.getElementById("moai-preloader"),selectinfo=document.getElementById("moai-select-info-text");preloder.style.display="block",selectinfo.style.display="none";let formdata=new FormData;formdata.append("query",query),"text"===type?formdata.append("action-type","answer_query"):(formdata.append("action-type","generate_image"),formdata.append("generate_multiple","true")),formdata.append("action","moai_ajax_action"),formdata.append("_wpnonce",ajax_object_moai.moai_ajax_nonce),ajax_request=jQuery.ajax({url:ajax_object_moai.ajax_url_moai,type:"POST",data:formdata,processData:!1,contentType:!1}),ajax_request.done(response=>{preloder.style.display="none",selectinfo.style.display="block",resolve(response)}),ajax_request.fail(response=>{preloder.style.display="none",selectinfo.style.display="none",alert("Something went wrong retry"),reject(null)})})}var modal=document.getElementById("moai-modal");function moai_show_modal(){modal.style.display="block"}function moai_hide_modal(){modal.style.display="none"}var span=document.getElementById("moai-close-modal");span.onclick=function(){moai_hide_modal()},window.onclick=function(event){event.target==modal&&moai_hide_modal()};